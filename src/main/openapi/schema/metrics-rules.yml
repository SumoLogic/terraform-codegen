paths:
  v1:
    metricsRules:
      createRule:
        post:
          description: >-
            Create metrics rule with given name using provided match expressions and variables to extract.
            The rule will try to extract all variables from any metric that matches one of provided match expressions.
          tags:
            - metricsRules
          summary: Create metrics rule.
          operationId: createRule
          requestBody:
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/MetricsRuleDefinition'
          responses:
            200:
              description: Created metric rule.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/MetricsRuleDefinition'
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
      deleteRule:
        delete:
          description: >-
            Delete metrics rule given its identifier.
          tags:
            - metricsRules
          summary: Delete metrics rule.
          operationId: deleteRule
          parameters:
            - name: name
              description: Name of an existing rule.
              required: true
              in: path
              schema:
                type: string
                example: "LoadBalancerRule"
          responses:
            204:
              description: The requested rule was deleted.
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

components:
  schemas:
    MetricsRuleVariableDefinition:
      type: object
      required:
        - name
        - tagSequence
      properties:
        name:
          description: Name for extracted variable.
          type: string
          example: "cluster"
        tagSequence:
          description: Which tag to extract.
          type: string
          example: "$_rawName._2"

    MetricsRuleDefinition:
      type: object
      required:
        - name
        - matchExpression
        - variablesToExtract
      properties:
        name:
          description: Name of metrics rule.
          type: string
          example: "LoadBalancerRule"
        matchExpression:
          description: Match expression of metrics rule.
          type: string
          example: "_contentType=Graphite _sourceId=*"
        variablesToExtract:
          description: Variables to extract by metrics rule.
          type: array
          items:
            type: object
            $ref: '#/components/schemas/MetricsRuleVariableDefinition'
