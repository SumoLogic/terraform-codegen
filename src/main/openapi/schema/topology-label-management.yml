paths:
  # topology/labels/search endpoint
  topology:
    labels:
      search:
        post:
          summary: Get list of content items.
          description: Get list of content items.
          operationId: getContentItemsFromTopologySearchLabels
          tags:
            - topologyLabelManagement
          requestBody:
            description: >
                List of search labels to match against content items in a topology. The content item must match ALL the
                search labels specified in the provided list.
            examples:
              - key: namespace
                value: kube-system
                isRequired: false
              - key: service
                value: kube-scheduler
                isRequired: false
              - key: pod
                value: '*'
                isRequired: true
            required: true
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/TopologySearchLabelList'
          responses:
            200:
              description: List of content items matching the given search labels.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/TopologyContentList'
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
components:
  schemas:
    TopologyLabelMap:
      type: object
      required:
        - data
      description: >
        Map of the topology labels. Each label has a key and a list of values. If a value is `*`,
        it means the label will match content for all values of its key.
      example:
        service:
          - kube-scheduler
          - kube-dns
      # NOTE(hanlin, 2019-04-30):
      # https://github.com/OpenAPITools/openapi-generator/issues/1139
      # https://github.com/OpenAPITools/openapi-generator/issues/1878
      # adding data field to avoid this being generated as an alias class of map, alias classes generated from
      # openapi-generator have bugs
      properties:
        data:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/TopologyLabelValuesList'
    TopologyLabelValuesList:
      type: array
      description: List of values corresponding to a key of a label.
      example: kube-scheduler
      items:
        description: Value of the label.
        type: string
      default: []
    TopologySearchLabelList:
      type: object
      properties:
        data:
          type: array
          description: List of topology labels to search for.
          items:
            $ref: '#/components/schemas/TopologySearchLabel'
          default: []
        partialMatch:
          description: >
            Whether the content item is required to contain a full set of the labels in order to be matched.
            If true, content items containing a partial set of the labels will be matched.
            If false, content items containing a partial set of the labels will not be matched.
          type: boolean
          default: false
    TopologySearchLabel:
      type: object
      description: >
        Topology label to search for. Each label has a key and a list of values. If a value is `*`,
        it means we want to match for all values of the label's key.
      example:
        key: pod
        value: '*'
        isRequired: true
      required:
        - key
        - value
      properties:
        key:
          description: Key of a topology label to search for.
          type: string
        value:
          description: Value of a topology label to search for.
          type: string
        isRequired:
          description: >
            Whether the content item is required to contain this label in order to be matched. If true, content items
            without this label will not be matched. If false, content items without this label will be matched.
          type: boolean
    TopologyContent:
      type: object
      allOf:
        - $ref: './generic-models.yml#/components/schemas/Content'
        - properties:
            accessKey:
              description: Access key of the topology content item.
              type: string
    TopologyContentList:
      description: List of topology content items
      type: array
      items:
        $ref: '#/components/schemas/TopologyContent'
