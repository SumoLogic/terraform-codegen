paths:
  v1:
    # /v1/apps endpoint
    apps:
      get:
        summary: List available apps.
        description: Lists all available apps from the App Catalog.
        operationId: listApps
        tags:
          - appManagement
        responses:
          200:
            description: List of all available apps.
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ListAppsResult'
          default:
            description: Operation failed with an error.
            content:
              application/json:
                schema:
                  $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
      # /v1/apps/import endpoint
      import:
        post:
          x-visibility: private
          summary: Import an app.
          description: Imports an app to the Library given the app definition and app manifest files.
          operationId: importApp
          tags:
            - appManagement
          requestBody:
            content:
              multipart/form-data:
                schema:
                  type: object
                  required:
                    - appDefinition
                    - appManifest
                  properties:
                    appDefinition:
                      type: string
                      format: binary
                    appManifest:
                      type: string
                      format: binary
          responses:
            200:
              description: App import job has been scheduled.
              content:
                application/json:
                  schema:
                    $ref: './generic-models.yml#/components/schemas/BeginAsyncJobResponse'
            default:
              description: App import failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
        jobId:
          # /v1/apps/import/{jobId}/status
          importStatus:
            get:
              x-visibility: private
              summary: App import job status.
              description: Get status of asynchronous app import request for the given job identifier.
              operationId: getAsyncImportStatus
              tags:
                - appManagement
              parameters:
                - name: jobId
                  description: The identifier of the asynchronous import job.
                  required: true
                  in: path
                  schema:
                    type: string
              responses:
                200:
                  description: The status of the app import job.
                  content:
                    application/json:
                      schema:
                        $ref: './generic-models.yml#/components/schemas/AsyncJobStatus'
                default:
                  description: App import failed with an error.
                  content:
                    application/json:
                      schema:
                        $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
      appUuid:
        # /v1/apps/{uuid}
        get:
          summary: Get an app by UUID.
          description: Gets the app with the given universally unique identifier (UUID).
          operationId: getApp
          tags:
            - appManagement
          parameters:
            - name: uuid
              description: The identifier of the app to retrieve.
              required: true
              in: path
              schema:
                type: string
                format: uuid
          responses:
            200:
              description: The retrieved app.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/App'
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
        # /v1/apps/{uuid}/install endpoint
        install:
          post:
            summary: Install an app by UUID.
            description: Installs the app with given UUID in the folder specified using destinationFolderId.
            operationId: installApp
            tags:
              - appManagement
            parameters:
              - name: uuid
                description: UUID of the app to install.
                required: true
                in: path
                schema:
                  type: string
                  format: uuid
            requestBody:
              required: true
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/AppInstallRequest'
            responses:
              200:
                description: App install job has been scheduled.
                content:
                  application/json:
                    schema:
                      $ref: './generic-models.yml#/components/schemas/BeginAsyncJobResponse'
              default:
                description: App installation failed with an error.
                content:
                  application/json:
                    schema:
                      $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
          # /v1/apps/install/{jobId}/status
          installStatus:
            get:
              summary: App install job status.
              description: Get the status of an asynchronous app install request for the given job identifier.
              operationId: getAsyncInstallStatus
              tags:
                - appManagement
              parameters:
                - name: jobId
                  description: The identifier of the asynchronous install job.
                  required: true
                  in: path
                  schema:
                    type: string
              responses:
                200:
                  description: The status of the app install job.
                  content:
                    application/json:
                      schema:
                        $ref: './generic-models.yml#/components/schemas/AsyncJobStatus'
                default:
                  description: App installation failed with an error.
                  content:
                    application/json:
                      schema:
                        $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
components:
  schemas:
    ListAppsResult:
      description: List of all available apps from the App Catalog.
      type: object
      required:
        - apps
      properties:
        apps:
          type: array
          description: An array of Apps
          items:
            $ref: '#/components/schemas/App'
    App:
      # FIXME(akshay, 2019-06-10): Removed modifiedAt since MetaModel should be used. Since import app will be executed
      # by someone at Sumo or by system user, exposing MetaModel doesn't make sense. MetaModel should be added if this changes in future.
      type: object
      required:
        - appDefinition
        - appManifest
      properties:
        appDefinition:
          description: App definition
          $ref: '#/components/schemas/AppDefinition'
        appManifest:
          description: App manifest
          $ref: '#/components/schemas/AppManifest'
    AppDefinition:
      type: object
      # TODO (akshay, 2019-5-24): Replace required with actual required fields
      required:
        - contentId
        - uuid
        - name
        - appVersion
      properties:
        contentId:
          description: Content identifier of the app in hexadecimal format.
          type: string
          example: 00000000000011AE
        uuid:
          description: Unique identifier for the app.
          type: string
          format: uuid
          example: 1c57fbc3-3141-4b12-aab3-5f40152bc3d9
        name:
          description: Name of the app.
          type: string
          example: "Sumo Config"
        appVersion:
          description: Version of the app.
          type: string
          example: 1.0
        preview:
          description: Indicates whether the app is in preview or not.
          type: boolean
          example: true
        manifestVersion:
          description: Manifest version of the app
          type: string
          example: 0.1
    AppManifest:
      type: object
      # TODO (akshay, 2019-5-24): Replace required with actual required fields
      required:
        - description
        - hoverText
        - iconURL
      properties:
        description:
          description: Description of the app.
          type: string
          example: "A description for Sumo Logic Config App."
        categories:
          description: Categories that the app belongs to.
          type: array
          items:
            type: string
          example: [Sumo Logic, Configuration]
        hoverText:
          description: Text to be displayed when hovered over in UI.
          type: string
          example: "Sumo Config App"
        iconURL:
          description: App icon URL.
          type: string
          example: "https://sumologic-app-data.sumologic.com/icons/sumoconfig.png"
        screenshotURLs:
          description: App screenshot URLs.
          type: array
          items:
            type: string
          example: [
            "https://sumologic-app-data.sumologic.com/icons/sumoconfig/overview.png",
            "https://sumologic-app-data.sumologic.com/screenshots/sumoconfig/details.png"
          ]
        helpURL:
          description: App help page URL.
          type: string
          example: "https://help.sumologic.com/"
        communityURL:
          description: App community page URL.
          type: string
          example: "https://support.sumologic.com/hc/en-us/community/topics/200263058-Applications-and-Integrations"
        requirements:
          description: Requirements for the app.
          type: array
          items:
            type: string
          example: []
        requiresInstallationInstructions:
          description: Indicates whether installation instructions are required or not.
          type: boolean
          example: false
        installationInstructions:
          description: Installation instructions for the app.
          type: string
          example: ""
        parameters:
          description: Content identifier of the app.
          type: array
          items:
            $ref: '#/components/schemas/ServiceManifestDataSourceParameter'
        author:
          description: App author.
          type: string
          example: "Sumo Logic"
        authorWebsite:
          description: App author website URL.
          type: string
          example: "https://www.sumologic.com"
    ServiceManifestDataSourceParameter:
      type: object
      # TODO (akshay, 2019-5-24): Replace required with actual required fields
      required:
        - parameterId
        - parameterType
      # TODO (akshay, 2019-5-24): Add meaningful descriptions
      properties:
        parameterType:
          description: Parameter type.
          type: string
          example: DATA_SOURCE
        parameterId:
          description: Parameter identifier.
          type: string
          example: paramId1
        dataSourceType:
          description: Data source type.
          type: string
          example: LOG
        label:
          description: Label.
          type: string
          example: "Log label"
        description:
          description: Description.
          type: string
          example: "Log data source"
        example:
          description: Example.
          type: string
          example: ""
        hidden:
          description: Should the UI display?
          type: boolean
          default: false
    AppInstallRequest:
      description: JSON object containing name, description, destinationFolderId, and dataSourceType.
      type: object
      required:
        - name
        - description
        - destinationFolderId
      properties:
        name:
          description: >-
            Preferred name of the app to be installed. This will be the name of the app in the selected installation
            folder.
          type: string
          example: "Sumo Logic Configuration App"
          minLength: 1
          maxLength: 128
        description:
          description: >-
            Preferred description of the app to be installed. This will be displayed as the app description in the selected
            installation folder.
          type: string
          minLength: 1
          maxLength: 255
          example: "Sumo Logic Configuration App to configure collectors and data sources"
        destinationFolderId:
          description: Identifier of the folder in which the app will be installed in hexadecimal format.
          type: string
          example: 00000000000001C8
        dataSourceValues:
          description: Dictionary of properties specifying log-source name and value.
          type: object
          additionalProperties:
            type: string
          example:
            logsrc: _sourceCategory = api
