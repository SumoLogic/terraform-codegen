paths:
  metricsSearches:
    post:
      summary: Save a metrics search.
      description: >-
        Saves a metrics search in the content library. Metrics search consists of one or more queries, a time range,
        a quantization period and a set of chart properties like line width.
      operationId: createMetricsSearch
      tags:
        - metricsSearchesManagement
      parameters: []
      requestBody:
        description: The definition of the metrics search.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveMetricsSearchRequest'
      responses:
        200:
          description: Newly created metrics search.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsSearchInstance'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  metricsSearchesId:
    get:
      summary: Get a metrics search.
      description: >-
        Returns a metrics search with the specified identifier.
      tags:
        - metricsSearchesManagement
      operationId: getMetricsSearch
      parameters:
        - name: id
          description: Identifier of the metrics search.
          required: true
          in: path
          schema:
            type: string
      responses:
        200:
          description: A metrics search object with metadata.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsSearchInstance'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

    put:
      summary: Updates a metrics search.
      description: >-
        Updates a metrics search with the specified identifier. Partial updates are not supported, you must provide values
        for all fields.
      operationId: updateMetricsSearch
      tags:
        - metricsSearchesManagement
      parameters:
        - name: id
          description: Identifier of the metrics search.
          required: true
          in: path
          schema:
            type: string
      requestBody:
        description: An updated metrics search definition.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MetricsSearch'
      responses:
        200:
          description: The metrics saved search that was updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MetricsSearchInstance'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

    delete:
      summary: Deletes a metrics search.
      description: >-
        Deletes a metrics search from the content library.
      tags:
        - metricsSearchesManagement
      operationId: deleteMetricsSearch
      parameters:
        - name: id
          description: Identifier of the metrics search.
          required: true
          in: path
          schema:
            type: string
      responses:
        default:
          description: The operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
        204:
          description: The metrics search was successfully deleted.


components:
  schemas:
    MetricsSearch:
      description: Definition of a metrics search.
      type: object
      required:
      - title
      - description
      - timeRange
      - metricsQueries
      properties:
        title:
          description: Item title in the content library.
          type: string
          minLength: 1
          maxLength: 255
          # This is the same pattern as used in Prada SumoUtil.isValidName method.
          pattern: '^[a-zA-Z0-9 +%-@.,_()]+$'
          example: "Short title"
        description:
          description: Item description in the content library.
          type: string
          maxLength: 8192
          example: "Long and detailed description"
        timeRange:
          $ref: './generic-models.yml#/components/schemas/ResolvableTimeRange'
        logQuery:
          description: >-
            Log query used to add an overlay to the chart.
          type: string
          maxLength: 10240
          example: "my_metric | timeslice 1m | count by _timeslice"
        metricsQueries:
          description: Metrics queries, up to the maximum of six.
          type: array
          items:
            $ref: '#/components/schemas/MetricsSearchQuery'
        desiredQuantizationInSecs:
          description: Desired quantization in seconds.
          type: integer
          default: 0
          minimum: 0
          format: int32
          example: 60
        properties:
          description: >
            Chart properties, like line width, color palette, and the fill missing data method.
            Leave this field empty to use the defaults.

            This property contains JSON object encoded as a string.
          type: string
          example: "{ \\\"key\\\": \\\"value\\\" }"

    MetricsSearchInstance:
      allOf:
      - $ref: '#/components/schemas/MetricsSearch'
      - $ref: './generic-models.yml#/components/schemas/MetadataModel'
      - type: object
        required:
        - id
        properties:
          id:
            type: string
            description: Identifier of the metrics search.
            example: 000000000000001A
          parentId:
            type: string
            description: Identifier of the parent element in the content library, such as folder.
            example: 0000000000007D2B

    MetricsSearchQuery:
      description: Definition of a metrics query.
      type: object
      required:
      - rowId
      - query
      properties:
        rowId:
          description: >-
            Row identifier. All row IDs are represented by subsequent upper case letters starting with `A`.
          type: string
          example: 'A'
        query:
          description: Metrics query.
          type: string
          example: 'my_metric | avg'

    SaveMetricsSearchRequest:
      description: The definition of the metrics search to save in the content library.
      type: object
      allOf:
        - $ref: '#/components/schemas/MetricsSearch'
        - type: object
          required:
            - parentId
          properties:
            parentId:
              type: string
              description: >-
                Identifier of a folder to which the metrics search should be added.
              example: 000000000000001A
