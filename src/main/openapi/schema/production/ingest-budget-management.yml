paths:
  # /ingestBudgets endpoint
  ingestBudgets:
    get:
      summary: Get a list of ingest budgets.
      description: >-
        Get a list of all ingest budgets. The response is paginated with a default limit of 100 budgets per page.
      operationId: listIngestBudgets
      tags:
      - ingestBudgetManagementV1
      parameters:
      - name: limit
        description: >-
          Limit the number of budgets returned in the response. The number of budgets returned may be less than the `limit`.
        required: false
        in: query
        schema:
          default: 100
          minimum: 1
          type: integer
          maximum: 1000
          format: int32
      - name: token
        description: >-
          Continuation token to get the next page of results. A page object with the next continuation token is returned
          in the response body. Subsequent GET requests should specify the continuation token to get the next page of
          results.
        required: false
        in: query
        schema:
          type: string
      responses:
        200:
          description: A paginated list of budgets.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListIngestBudgetsResponse'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    post:
      summary: Create a new ingest budget.
      description: Create a new ingest budget.
      operationId: createIngestBudget
      tags:
      - ingestBudgetManagementV1
      parameters: []
      requestBody:
        description: Information about the new ingest budget.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestBudgetDefinition'
      responses:
        200:
          description: The ingest budget has been created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestBudget'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  # /ingestBudgets/{id} endpoint
  ingestBudgetId:
    get:
      summary: Get an ingest budget.
      description: Get an ingest budget by the given identifier.
      operationId: getIngestBudget
      tags:
      - ingestBudgetManagementV1
      parameters:
      - name: id
        description: Identifier of ingest budget to return.
        required: true
        in: path
        schema:
          type: string
      responses:
        200:
          description: Ingest budget object that was requested.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestBudget'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    put:
      summary: Update an ingest budget.
      description: >-
        Update an existing ingest budget. All properties specified in the request are required.
      operationId: updateIngestBudget
      tags:
      - ingestBudgetManagementV1
      parameters:
      - name: id
        description: Identifier of the ingest budget to update.
        required: true
        in: path
        schema:
          type: string
      requestBody:
        description: Information to update about the ingest budget.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestBudgetDefinition'
      responses:
        200:
          description: The ingest budget was successfully modified.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestBudget'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    delete:
      summary: Delete an ingest budget.
      description: Delete an ingest budget with the given identifier.
      operationId: deleteIngestBudget
      tags:
      - ingestBudgetManagementV1
      parameters:
      - name: id
        description: Identifier of the ingest budget to delete.
        required: true
        in: path
        schema:
          type: string
      responses:
        204:
          description: The ingest budget was deleted successfully.
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

    # /ingestBudgets/{id}/usage/reset endpoint
    usage:
      reset:
        post:
          summary: Reset usage.
          description: >-
            Reset ingest budget's current usage to 0 before the scheduled reset time.
          operationId: resetUsage
          tags:
          - ingestBudgetManagementV1
          parameters:
          - name: id
            description: Identifier of the ingest budget to reset usage.
            required: true
            in: path
            schema:
              type: string
          responses:
            200:
              description: Ingest budget's usage was reset successfully.
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

    # /ingestBudgets/{id}/collectors endpoint
    collectors:
      get:
        summary: Get a list of Collectors.
        description: >-
          Get a list of Collectors assigned to an ingest budget. The response is paginated with a default limit of 100
          Collectors per page.
        operationId: getAssignedCollectors
        tags:
        - ingestBudgetManagementV1
        parameters:
        - name: id
          description: Identifier of ingest budget to which Collectors are assigned.
          required: true
          in: path
          schema:
            type: string
        - name: limit
          description: >-
            Limit the number of Collectors returned in the response. The number of Collectors returned may be less than
            the `limit`.
          required: false
          in: query
          schema:
            default: 100
            minimum: 1
            type: integer
            maximum: 1000
            format: int32
        - name: token
          description: >-
            Continuation token to get the next page of results. A page object with the next continuation token is returned
            in the response body. Subsequent GET requests should specify the continuation token to get the next page
            of results.
          required: false
          in: query
          schema:
            type: string
        responses:
          200:
            description: A paginated list of Collectors.
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ListCollectorIdentitiesResponse'
          default:
            description: Operation failed with an error.
            content:
              application/json:
                schema:
                  $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

    # /ingestBudgets/{id}/collectors/{collectorId} endpoint
    collectorId:
      put:
        summary: Assign a Collector to a budget.
        description: Assign a Collector to a budget.
        operationId: assignCollectorToBudget
        tags:
        - ingestBudgetManagementV1
        parameters:
        - name: id
          description: Identifier of the ingest budget to assign to the Collector.
          required: true
          in: path
          schema:
            type: string
        - name: collectorId
          description: Identifier of the Collector to assign.
          required: true
          in: path
          schema:
            type: string
        responses:
          200:
            description: Collector was successfully assigned to the ingest budget.
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/IngestBudget'
          default:
            description: Operation failed with an error.
            content:
              application/json:
                schema:
                  $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
      delete:
        summary: Remove Collector from a budget.
        description: Remove Collector from a budget.
        operationId: removeCollectorFromBudget
        tags:
        - ingestBudgetManagementV1
        parameters:
        - name: id
          description: Identifier of the ingest budget to unassign from the Collector.
          required: true
          in: path
          schema:
            type: string
        - name: collectorId
          description: Identifier of the Collector to unassign.
          required: true
          in: path
          schema:
            type: string
        responses:
          200:
            description: Collector was successfully unassigned from the ingest budget.
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/IngestBudget'
          default:
            description: Operation failed with an error.
            content:
              application/json:
                schema:
                  $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

components:
  schemas:
    IngestBudgetDefinition:
      type: object
      required:
      - name
      - fieldValue
      - capacityBytes
      - timezone
      - resetTime
      - action
      properties:
        name:
          description: Display name of the ingest budget.
          type: string
          example: 'Developer Budget'
          minLength: 1
          maxLength: 128
        fieldValue:
          description: Custom field value that is used to assign Collectors to the ingest budget.
          type: string
          example: 'dev_30_gb'
          minLength: 1
          maxLength: 1024
        capacityBytes:
          description: Capacity of the ingest budget, in bytes. It takes a few minutes for Collectors to stop collecting
            when capacity is reached. We recommend setting a soft limit that is lower than your needed hard limit.
          type: integer
          format: int64
          example: 1000
          minimum: 0
        timezone:
          description: >-
            Time zone of the reset time for the ingest budget. Follow the format in the [IANA Time Zone Database](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List).
          type: string
          example: 'America/Los_Angeles'
        resetTime:
          description: Reset time of the ingest budget in HH:MM format.
          type: string
          example: '23:30'
          minLength: 5
          maxLength: 5
        description:
          description: Description of the ingest budget.
          type: string
          minLength: 0
          maxLength: 1024
        action:
          type: string
          description: >-
            Action to take when ingest budget's capacity is reached. All actions are audited. Supported values are:
              * `stopCollecting`
              * `keepCollecting`
          example: 'stopCollecting'
        auditThreshold:
          description: The threshold as a percentage of when an ingest budget's capacity usage is logged in the Audit Index.
          type: integer
          format: int32
          minimum: 1
          maximum: 99
          example: 85
    IngestBudget:
      type: object
      allOf:
      - $ref: '#/components/schemas/IngestBudgetDefinition'
      - $ref: './generic-models.yml#/components/schemas/MetadataWithUserInfo'
      - required:
        - id
        properties:
          id:
            description: Unique identifier for the ingest budget.
            type: string
          usageBytes:
            description: Current usage since the last reset, in bytes.
            type: integer
            format: int64
            example: 900
          usageStatus:
            description: >-
              Status of the current usage. Can be `Normal`, `Approaching`, `Exceeded`, or `Unknown` (unable to retrieve
              usage).
            type: string
            example: 'Approaching'
          numberOfCollectors:
            description: Number of collectors assigned to the ingest budget.
            type: integer
            format: int64
            example: 10
    ListIngestBudgetsResponse:
      type: object
      required:
      - data
      properties:
        data:
          description: List of ingest budgets.
          type: array
          items:
            $ref: '#/components/schemas/IngestBudget'
        next:
          description: Next continuation token.
          type: string
    CollectorIdentity:
      type: object
      required:
      - id
      - name
      properties:
        id:
          description: Unique identifier for the Collector.
          type: string
        name:
          description: The name of the Collector.
          type: string
    ListCollectorIdentitiesResponse:
      type: object
      required:
      - data
      properties:
        data:
          description: List of Collector identities.
          type: array
          items:
            $ref: '#/components/schemas/CollectorIdentity'
        next:
          description: Next continuation token.
          type: string
