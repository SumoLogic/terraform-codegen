paths:
  partitions:
    get:
      summary: Get a list of partitions.
      description: >-
        Get a list of all partitions in the organization. The response is paginated with a default limit of 100 partitions
        per page.
      operationId: listPartitions
      tags:
      - partitionManagement
      parameters:
      - name: limit
        description: >-
          Limit the number of partitions returned in the response. The number of partitions returned may be less than
          the `limit`.
        required: false
        in: query
        schema:
          default: 100
          minimum: 1
          type: integer
          maximum: 1000
          format: int32
      - name: token
        description: >-
          Continuation token to get the next page of results. A page object with the next continuation token is returned
          in the response body. Subsequent GET requests should specify the continuation token to get the next page of
          results. `token` is set to null when no more pages are left.
        required: false
        in: query
        schema:
          type: string
      - name: activeOnly
        description: >-
          Set this value to `true` to get only active partitions in response. If set to `false` all partitions are
          returned.
        required: false
        in: query
        schema:
          default: false
          type: boolean
      - name: analyticsTier
        description: >-
          Set this value to one of `continuous`, `frequent` or `infrequent` to get partitions of a specific analytics
          tier in the response. Partitions of all tiers are returned if value is not set.
        required: false
        in: query
        schema:
          type: string
      responses:
        200:
          description: A paginated list of partitions in the organization.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListPartitionsResponse'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    post:
      summary: Create a new partition.
      description: Create a new partition.
      operationId: createPartition
      tags:
      - partitionManagement
      parameters: []
      requestBody:
        description: Information about the new partition.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePartitionDefinition'
      responses:
        200:
          description: The partition has been created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Partition'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  # /partitions/id endpoint
  partitionsId:
    get:
      summary: Get a partition.
      description: Get a partition with the given identifier from the organization.
      operationId: getPartition
      tags:
      - partitionManagement
      parameters:
      - name: id
        description: Identifier of partition to return.
        required: true
        in: path
        schema:
          type: string
      responses:
        200:
          description: Partition object that was requested.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Partition'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    put:
      summary: Update a partition.
      description: >-
        Update an existing partition in the organization.
      operationId: updatePartition
      tags:
      - partitionManagement
      parameters:
      - name: id
        description: Identifier of the partition to update.
        required: true
        in: path
        schema:
          type: string
      requestBody:
        description: Information to update about the partition.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePartitionDefinition'
      responses:
        200:
          description: The partition was successfully modified.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Partition'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  partitionsByIds:
    get:
      x-visibility: private
      summary: Bulk read partitions.
      description: Bulk read partitions by the given identifiers.
      operationId: partitionsReadByIds
      tags:
        - partitionManagement
      parameters:
        - name: ids
          description: A comma-separated list of identifiers.
          required: true
          in: path
          schema:
            type: array
            items:
              type: string
            uniqueItems: true
            minItems: 1
            maxItems: 1000
          example: 0000000000000001,0000000000000002,0000000000000003
      responses:
        200:
          description: Array of partitions for requested identifiers.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PartitionsResponse'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  # /partitions/id/decommission endpoint
  partitionsIdDecommission:
    post:
      summary: Decommission a partition.
      description: >-
        Decommission a partition with the given identifier from the organization.
      operationId: decommissionPartition
      tags:
      - partitionManagement
      parameters:
      - name: id
        description: Identifier of the partition to decommission.
        required: true
        in: path
        schema:
          type: string
      responses:
        200:
          description: The partition was decommissioned successfully.
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

components:
  schemas:
    CreatePartitionDefinition:
      type: object
      required:
      - name
      - routingExpression
      properties:
        name:
          description: The name of the partition.
          type: string
          example: "apache"
          maxLength: 255
        routingExpression:
          description: The query that defines the data to be included in the partition.
          type: string
          example: "_sourcecategory=*/Apache"
          minLength: 1
          maxLength: 16384
        dataForwardingId:
          description: An optional ID of a data forwarding configuration to be used by the partition.
          type: string
        analyticsTier:
          description: >-
            The Cloud Flex analytics tier for your data; only relevant if your account has basic analytics enabled. Possible
            values are:
              1. `continuous`
              2. `frequent`
              3. `infrequent`
          type: string
          example: "continuous"
          default: "continuous"
        retentionPeriod:
          description: >-
            The number of days to retain data in the partition, or -1 to use the default value for your account.  Only
            relevant if your account has variable retention enabled.
          type: integer
          example: 365
          default: -1
        isCompliant:
          description: >-
            Whether the partition is compliant or not. Mark a partition as compliant if it contains data used for compliance
            or audit purpose. Retention for a compliant partition can only be increased and cannot be reduced after the
            partition is marked compliant. A partition once marked compliant, cannot be marked non-compliant later.
          type: boolean
          example: false
          default: false
    UpdatePartitionDefinition:
      type: object
      properties:
        dataForwardingId:
          description: An optional ID of a data forwarding destination to be used by the partition.
          type: string
        retentionPeriod:
          description: >-
            The number of days to retain data in the partition, or -1 to use the default value for your account. Only
            relevant if your account has variable retention enabled.
          type: integer
          example: 365
          default: -1
        reduceRetentionPeriodImmediately:
          description: >-
            This is required if the newly specified `retentionPeriod` is less than the existing retention period.  In
            such a situation, a value of `true` says that data between the existing retention period and the new retention
            period should be deleted immediately; if `false`, such data will be deleted after seven days. This property
            is optional and ignored if the specified `retentionPeriod` is greater than or equal to the current retention
            period.
          type: boolean
          default: false
        isCompliant:
          description: >-
            Whether to mark a partition as compliant. Mark a partition as compliant if it contains data used for compliance
            or audit purpose. Retention for a compliant partition can only be increased and cannot be reduced after the
            partition marked as compliant. A partition once marked compliant, cannot be marked non-compliant later.
          type: boolean
          example: false
          default: false
    Partition:
      type: object
      allOf:
      - $ref: '#/components/schemas/CreatePartitionDefinition'
      - required:
        - id
        - totalBytes
        - createdAt
        - createdBy
        - modifiedAt
        properties:
          id:
            description: Unique identifier for the partition.
            type: string
          totalBytes:
            description: Size of data in partition in bytes.
            type: long
          isActive:
            description: >-
              This has the value `true` if the partition is active and `false` if it has been decommissioned.
            type: boolean
          createdAt:
            description: >-
              Creation timestamp in UTC in [RFC3339](https://tools.ietf.org/html/rfc3339) format.
            type: string
            format: date-time
          createdBy:
            description: Identifier of the user who created the resource.
            type: string
          modifiedAt:
            description: Last modification timestamp in UTC.
            type: string
            format: date-time
    ListPartitionsResponse:
      type: object
      required:
      - data
      properties:
        data:
          description: List of partitions.
          type: array
          items:
            $ref: '#/components/schemas/Partition'
        next:
          description: Next continuation token.
          type: string
    PartitionsResponse:
      type: object
      required:
      - data
      properties:
        data:
          description: Array of partitions.
          type: array
          items:
            $ref: '#/components/schemas/Partition'
