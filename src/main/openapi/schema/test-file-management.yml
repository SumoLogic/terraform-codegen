paths:
  system:
    parsers:
      repo:
        post:
          x-visibility: private
          summary: >
            Update parsers.
          description: >
            Updates parsers for this deployment to the latest in the parser repo.
          operationId: systemParsersPullFromRepo
          tags:
            - testParser
          produces:
            - application/json
          parameters:
            - name: lastUpdateTime
              description: The last time the parser repo was updated for this deployment. Only files changed after this time will be changed by the request.
              required: false
              in: query
              schema:
                type: string
                format: date-time
            - name: ref
              description: The latest commit hash for this repo that should be included.
              required: false
              in: query
              schema:
                type: string
          responses:
            200:
              description: List of changes to the parsers.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/ParsersLibraryChangeList'
            default:
              description: Operation failed with an error.
              content:
                application/json:
                  schema:
                    $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
  parsers:
    repo:
      post:
        x-visibility: private
        summary: >
          Update parsers for devs.
        description: >
          Update parsers for this org to the latest in the parser repo (for parser devs).
        operationId: parsersPullFromRepo
        tags:
          - testParser
        produces:
          - application/json
        parameters:
          - name: lastUpdateTime
            description: The last time the parser repo was updated for this deployment. Only files changed after this time will be changed by the request.
            required: false
            in: query
            schema:
              type: string
              format: date-time
          - name: ref
            description: The latest commit hash for this repo that should be included.
            required: false
            in: query
            schema:
              type: string
        responses:
          200:
            description: List of changes to the parsers.
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ParsersLibraryChangeList'
          default:
            description: Operation failed with an error.
            content:
              application/json:
                schema:
                  $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
  testFile:
    get:
      summary: >
        Get test files paths.
      description: >
        Get test files paths.
      operationId: testFileQuery
      tags:
        - testParser
      parameters:
        - name: queryString
          description: Component of path.
          required: true
          default:
          in: query
          minLength: 1
          pattern: '^(?! *$).*'
          x-pattern-message: "Test file name must contain nonspace characters."
          schema:
            type: string
            minLength: 1
            pattern: '^(?! *$).*'
            x-pattern-message: "Test file name must contain nonspace characters."
        - name: parserPath
          description: Path of the parser this test file was created for.
          in: query
          schema:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall
      responses:
        200:
          description: List of file names that match the query.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileNameList'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

  testFileId:
    get:
      summary: >
        Get a test file.
      description: >
        Get a test file.
      operationId: testFileGet
      tags:
        - testParser
      parameters:
        - name: filePath
          description: Path to the file.
          required: true
          in: path
          schema:
            type: string
            minLength: 1
            pattern: '^(?! *$).*'
            x-pattern-message: "Test file name must contain nonspace characters."
        - name: parserPath
          description: Path of the parser this test file was created for.
          in: query
          schema:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall
      responses:
        200:
          description: Requested test file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestFileMessageGroup'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    post:
      summary: >
        Create a test file.
      description: >
        Create a test file.
      operationId: testFileCreate
      tags:
        - testParser
      parameters:
        - name: filePath
          description: Path to the file.
          required: true
          in: path
          schema:
            type: string
            minLength: 1
            pattern: '^(?! *$).*'
            x-pattern-message: "Test file name must contain nonspace characters."
        - name: parserPath
          description: Path of the parser this test file was created for.
          in: query
          schema:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall
      requestBody:
        description: The log file.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestFileMessageGroup'
      responses:
        200:
          description: Created test file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestFileMessageGroup'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    put:
      summary: >
        Update a test file.
      description: >
        Update a test file.
      operationId: testFileUpdate
      tags:
        - testParser
      parameters:
        - name: filePath
          description: Path to the file.
          required: true
          in: path
          schema:
            type: string
            minLength: 1
            pattern: '^(?![^ ]*$).*'
            x-pattern-message: "Test file name must contain nonspace characters."
        - name: parserPath
          description: Path of the parser this test file was created for.
          in: query
          schema:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall
      requestBody:
        description: New test file.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TestFileMessageGroup'
      responses:
        200:
          description: Updated test file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestFileMessageGroup'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'
    delete:
      summary: >
        Delete a test file.
      description: >
        Delete a test file.
      operationId: testFileDelete
      tags:
        - testParser
      parameters:
        - name: filePath
          description: path to the file.
          required: true
          in: path
          schema:
            type: string
            minLength: 1
            pattern: '^(?! *$).*'
            x-pattern-message: "Test file name must contain nonspace characters."
        - name: parserPath
          description: Path of the parser this test file was created for.
          in: query
          schema:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall
      responses:
        200:
          description: Deleted test file.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TestFileMessageGroup'
        default:
          description: Operation failed with an error.
          content:
            application/json:
              schema:
                $ref: './generic-responses.yml#/components/schemas/ErrorResponse'

components:
  schemas:
    TestFileMessageGroup:
      description: object containing information about all messages in this test file.
      type: object
      required:
        - messages
      properties:
        messages:
          description: an array of message objects.
          type: array
          items:
            $ref: './test-file-management.yml#/components/schemas/TestFileMessage'
    TestFileMessage:
      type: object
      description: object containing the message and other elements we choose to add.
      required:
        - message
      properties:
        message:
          description: the message string.
          type: string
        metadata:
          description: dictionary of message metadata provided either by the user or by a Sumo search.
          type: object
          additionalProperties:
            type: string
    FileNameList:
      type: array
      description: object containing a list of files for a query response.
      items:
        type: string

    ParsersLibraryChangeList:
      type: object
      description: Object containing list of updated paths.
      properties:
        paths:
          description: List of paths updated.
          type: array
          items:
            type: string
            example: /Parsers/Sumo/Palo Alto Networks/Firewall